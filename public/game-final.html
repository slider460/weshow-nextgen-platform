<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö¥‚Äç‚ôÇÔ∏è –í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –≥–æ–Ω–∫–∏ - –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.8/p5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            text-align: center;
            min-height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #e0e0e0;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            height: 100vh;
            padding: 20px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 100;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .return-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
            z-index: 100;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }
        
        .lives {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .life {
            width: 30px;
            height: 30px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .life.lost {
            background: #95a5a6;
            opacity: 0.5;
        }
        
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 2px solid #4CAF50;
            display: none;
            z-index: 1000;
            max-width: 500px;
        }
        
        .game-over.failure {
            border-color: #e74c3c;
        }
        
        .discount-code {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.5em;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-width: 600px;
            backdrop-filter: blur(10px);
        }
        
        .instructions h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .instructions ul {
            text-align: left;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        #gameCanvas {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .controls { flex-direction: column; }
            .stats { flex-direction: column; }
        }
    </style>
</head>
<body>
    <h1>üö¥‚Äç‚ôÇÔ∏è –í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –≥–æ–Ω–∫–∏</h1>
    <p class="subtitle">–ü–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–π—Ç–µ –º—É–ª—å—Ç–∏–º–µ–¥–∏–π–Ω—É—é —Ç–µ—Ö–Ω–∏–∫—É –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ —Å–∫–∏–¥–∫–∏!</p>
    
    <div class="game-container">
        <div class="controls">
            <button id="startBtn" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –≥–æ–Ω–∫—É</button>
            <button id="pauseBtn" onclick="pauseGame()" disabled>‚è∏Ô∏è –ü–∞—É–∑–∞</button>
            <button class="return-btn" onclick="window.location.href='/'">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</button>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">–û—á–∫–∏</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="timeLeft">30</div>
                <div class="stat-label">–í—Ä–µ–º—è</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="combo">0x</div>
                <div class="stat-label">–ö–æ–º–±–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successfulJumps">0</div>
                <div class="stat-label">–£—Å–ø–µ—à–Ω—ã–µ –ø—Ä—ã–∂–∫–∏</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–ñ–∏–∑–Ω–∏</div>
                <div class="lives" id="lives">
                    <div class="life">‚ù§Ô∏è</div>
                    <div class="life">‚ù§Ô∏è</div>
                    <div class="life">‚ù§Ô∏è</div>
                </div>
            </div>
        </div>
        
        <div id="gameCanvas"></div>
        
        <div class="instructions">
            <h3>üéØ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
            <ul>
                <li><strong>–ú—ã—à—å:</strong> –ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø—Ä—ã–∂–∫–∞</li>
                <li><strong>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:</strong> –ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è –ø—Ä—ã–∂–∫–∞</li>
                <li><strong>–¶–µ–ª—å:</strong> –ü–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–π—Ç–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –æ—á–∫–∏</li>
                <li><strong>–ñ–∏–∑–Ω–∏:</strong> –£ –≤–∞—Å 3 –∂–∏–∑–Ω–∏, –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ —Ç–µ—Ä—è–µ—Ç–µ 1</li>
                <li><strong>–í—Ä–µ–º—è:</strong> –£ –≤–∞—Å –µ—Å—Ç—å 30 —Å–µ–∫—É–Ω–¥!</li>
                <li><strong>–°–∫–∏–¥–∫–∏:</strong> 100+ –æ—á–∫–æ–≤ = 5%, 200+ = 10%, 500+ = 15%, 1000+ = 25%</li>
            </ul>
        </div>
    </div>
    
    <div class="game-over" id="gameOverModal">
        <h2 id="gameOverTitle">üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <div id="finalScore"></div>
        <div id="discountCode" class="discount-code" style="display: none;"></div>
        <button onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            timeLeft: 30,
            level: 1,
            combo: 0,
            maxCombo: 0,
            gameSpeed: 1,
            successfulJumps: 0,
            totalObstacles: 0,
            lives: 3,
            gameOver: false
        };
        
        let bike = {
            x: 100,
            y: 350,
            width: 40,
            height: 25,
            isJumping: false,
            jumpStart: 0,
            jumpHeight: 120,
            jumpDuration: 700,
            baseY: 350
        };
        
        let obstacles = [];
        let particles = [];
        let obstacleId = 0;
        let gameTimer;
        let obstacleTimer;
        
        // p5.js —Ñ—É–Ω–∫—Ü–∏–∏
        function setup() {
            const canvas = createCanvas(800, 400);
            canvas.parent('gameCanvas');
            frameRate(60);
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
            drawBackground();
            drawGround();
            drawBike();
            drawInstructions();
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('keydown', function(e) {
                if (e.key === ' ' && e.target === document.body) {
                    e.preventDefault();
                }
            });
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
            document.addEventListener('wheel', function(e) {
                e.preventDefault();
            }, { passive: false });
        }
        
        function draw() {
            if (!gameState.isPlaying || gameState.isPaused || gameState.gameOver) return;
            
            // –û—á–∏—Å—Ç–∫–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
            drawBackground();
            drawGround();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
            updateParticles();
            particles.forEach(drawParticle);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            updateObstacles();
            obstacles.forEach(drawObstacle);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞
            updateBike();
            drawBike();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
            checkCollisions();
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            gameState.score++;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            const newLevel = Math.floor(gameState.score / 200) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                gameState.gameSpeed = 1 + (newLevel - 1) * 0.2;
                createLevelUpEffect();
            }
        }
        
        function drawBackground() {
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω —Å –æ–±–ª–∞–∫–∞–º–∏
            for (let y = 0; y < height; y++) {
                let inter = map(y, 0, height, 0, 1);
                let c = lerpColor(color(135, 206, 235), color(224, 246, 255), inter);
                stroke(c);
                line(0, y, width, y);
            }
            
            // –û–±–ª–∞–∫–∞
            drawClouds();
        }
        
        function drawClouds() {
            fill(255, 255, 255, 100);
            noStroke();
            
            // –°—Ç–∞—Ç–∏—á–Ω—ã–µ –æ–±–ª–∞–∫–∞
            ellipse(100, 80, 60, 40);
            ellipse(130, 80, 80, 50);
            ellipse(160, 80, 60, 40);
            
            ellipse(400, 60, 70, 45);
            ellipse(430, 60, 90, 55);
            ellipse(460, 60, 70, 45);
            
            ellipse(700, 100, 50, 35);
            ellipse(720, 100, 60, 40);
        }
        
        function drawGround() {
            // –û—Å–Ω–æ–≤–Ω–∞—è –∑–µ–º–ª—è
            fill(143, 188, 143);
            noStroke();
            rect(0, 350, width, 50);
            
            // –¢–µ–∫—Å—Ç—É—Ä–∞ –∑–µ–º–ª–∏
            fill(34, 139, 34);
            for (let x = 0; x < width; x += 20) {
                rect(x, 350, 10, 50);
            }
            
            // –î–æ—Ä–æ–∂–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞
            fill(255, 255, 0);
            for (let x = 0; x < width; x += 60) {
                rect(x, 370, 30, 5);
            }
        }
        
        function drawBike() {
            // –¢–µ–Ω—å –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞
            fill(0, 0, 0, 50);
            noStroke();
            ellipse(bike.x + 20, bike.baseY + 5, 50, 10);
            
            // –†–∞–º–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞
            stroke(231, 76, 60);
            strokeWeight(4);
            noFill();
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–º–∞
            beginShape();
            vertex(bike.x, bike.y);
            vertex(bike.x + 40, bike.y);
            vertex(bike.x + 20, bike.y - 20);
            vertex(bike.x, bike.y);
            endShape();
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
            stroke(200, 50, 40);
            strokeWeight(2);
            noFill();
            line(bike.x + 5, bike.y - 10, bike.x + 35, bike.y - 10);
            
            // –ö–æ–ª–µ—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            stroke(44, 62, 80);
            strokeWeight(3);
            fill(255, 255, 255);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–ª–µ—Å
            let wheelRotation = frameCount * 0.1;
            push();
            translate(bike.x + 10, bike.y);
            rotate(wheelRotation);
            circle(0, 0, 18);
            pop();
            
            push();
            translate(bike.x + 30, bike.y);
            rotate(wheelRotation);
            circle(0, 0, 18);
            pop();
            
            // –°–ø–∏—Ü—ã –∫–æ–ª–µ—Å
            stroke(100, 100, 100);
            strokeWeight(1);
            for (let i = 0; i < 8; i++) {
                let angle = (i * PI) / 4 + wheelRotation;
                let x1 = bike.x + 10 + cos(angle) * 8;
                let y1 = bike.y + sin(angle) * 8;
                let x2 = bike.x + 10 + cos(angle) * 16;
                let y2 = bike.y + sin(angle) * 16;
                line(x1, y1, x2, y2);
                
                x1 = bike.x + 30 + cos(angle) * 8;
                x2 = bike.x + 30 + cos(angle) * 16;
                line(x1, y1, x2, y2);
            }
            
            // –†—É–ª—å
            stroke(231, 76, 60);
            strokeWeight(3);
            line(bike.x + 20, bike.y - 20, bike.x + 20, bike.y - 30);
            circle(bike.x + 20, bike.y - 30, 8);
            
            // –§–∞—Ä—ã
            fill(255, 255, 0);
            noStroke();
            circle(bike.x + 35, bike.y - 15, 6);
        }
        
        function drawObstacle(obstacle) {
            // –¢–µ–Ω—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            fill(0, 0, 0, 30);
            noStroke();
            ellipse(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height + 5, obstacle.width + 10, 8);
            
            // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
            let gradient = drawingContext.createLinearGradient(obstacle.x, obstacle.y, obstacle.x, obstacle.y + obstacle.height);
            
            switch(obstacle.type) {
                case 'projector':
                    gradient.addColorStop(0, '#2c3e50');
                    gradient.addColorStop(0.5, '#34495e');
                    gradient.addColorStop(1, '#2c3e50');
                    break;
                case 'touchpanel':
                    gradient.addColorStop(0, '#3498db');
                    gradient.addColorStop(0.5, '#2980b9');
                    gradient.addColorStop(1, '#3498db');
                    break;
                case 'computer':
                    gradient.addColorStop(0, '#95a5a6');
                    gradient.addColorStop(0.5, '#7f8c8d');
                    gradient.addColorStop(1, '#95a5a6');
                    break;
                case 'speaker':
                    gradient.addColorStop(0, '#e74c3c');
                    gradient.addColorStop(0.5, '#c0392b');
                    gradient.addColorStop(1, '#e74c3c');
                    break;
                case 'camera':
                    gradient.addColorStop(0, '#9b59b6');
                    gradient.addColorStop(0.5, '#8e44ad');
                    gradient.addColorStop(1, '#9b59b6');
                    break;
            }
            
            drawingContext.fillStyle = gradient;
            rect(obstacle.x, obstacle.y, obstacle.width, obstacle.height, 5);
            
            // –î–µ—Ç–∞–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            drawObstacleDetails(obstacle);
        }
        
        function drawObstacleDetails(obstacle) {
            switch(obstacle.type) {
                case 'projector':
                    fill(0, 0, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 15);
                    fill(255, 255, 255);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 8);
                    fill(100, 100, 100);
                    circle(obstacle.x + 8, obstacle.y + 8, 4);
                    circle(obstacle.x + obstacle.width - 8, obstacle.y + 8, 4);
                    fill(0, 255, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + 5, 3);
                    break;
                    
                case 'touchpanel':
                    fill(0, 0, 0);
                    rect(obstacle.x + 3, obstacle.y + 3, obstacle.width - 6, obstacle.height - 6, 3);
                    fill(0, 255, 0);
                    circle(obstacle.x + 8, obstacle.y + obstacle.height - 8, 3);
                    fill(255, 255, 0);
                    circle(obstacle.x + obstacle.width - 8, obstacle.y + obstacle.height - 8, 3);
                    break;
                    
                case 'computer':
                    fill(0, 0, 0);
                    rect(obstacle.x + 2, obstacle.y + 2, obstacle.width - 4, obstacle.height - 4, 3);
                    fill(255, 0, 0);
                    circle(obstacle.x + obstacle.width - 8, obstacle.y + 8, 3);
                    fill(255, 255, 255);
                    textSize(8);
                    textAlign(CENTER, CENTER);
                    text('PC', obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2);
                    break;
                    
                case 'speaker':
                    fill(0, 0, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 20);
                    fill(100, 100, 100);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 15);
                    fill(0, 0, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 8);
                    fill(50, 50, 50);
                    for (let i = 0; i < 6; i++) {
                        let angle = (i * PI) / 3;
                        let x = obstacle.x + obstacle.width/2 + cos(angle) * 12;
                        let y = obstacle.y + obstacle.height/2 + sin(angle) * 12;
                        circle(x, y, 2);
                    }
                    break;
                    
                case 'camera':
                    fill(0, 0, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 18);
                    fill(50, 50, 50);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 12);
                    fill(0, 0, 0);
                    circle(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, 6);
                    fill(255, 0, 0);
                    circle(obstacle.x + 8, obstacle.y + 8, 4);
                    fill(255, 255, 255);
                    rect(obstacle.x + obstacle.width - 12, obstacle.y + 5, 8, 6, 2);
                    break;
            }
        }
        
        function drawInstructions() {
            fill(255);
            textSize(18);
            textAlign(CENTER, CENTER);
            text('–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –≥–æ–Ω–∫—É" –¥–ª—è —Å—Ç–∞—Ä—Ç–∞!', width/2, height/2);
        }
        
        function updateBike() {
            if (bike.isJumping) {
                const elapsed = millis() - bike.jumpStart;
                const progress = min(elapsed / bike.jumpDuration, 1);
                
                const jumpHeight = bike.jumpHeight * sin(progress * PI);
                bike.y = bike.baseY - jumpHeight;
                
                bike.x += sin(progress * PI * 4) * 0.5;
                
                if (progress >= 1) {
                    bike.isJumping = false;
                    bike.y = bike.baseY;
                    bike.x = 100;
                }
            }
        }
        
        function updateObstacles() {
            obstacles = obstacles
                .map(obstacle => ({
                    ...obstacle,
                    x: obstacle.x - 3 * gameState.gameSpeed
                }))
                .filter(obstacle => obstacle.x > -obstacle.width);
        }
        
        function updateParticles() {
            particles = particles
                .map(particle => ({
                    ...particle,
                    x: particle.x + particle.vx,
                    y: particle.y + particle.vy,
                    life: particle.life - 1,
                    alpha: particle.alpha - 0.02
                }))
                .filter(particle => particle.life > 0 && particle.alpha > 0);
        }
        
        function drawParticle(particle) {
            push();
            fill(particle.color.levels[0], particle.color.levels[1], particle.color.levels[2], particle.alpha * 255);
            noStroke();
            circle(particle.x, particle.y, particle.size);
            pop();
        }
        
        function createParticle(x, y, color) {
            particles.push({
                x: x,
                y: y,
                vx: random(-2, 2),
                vy: random(-3, -1),
                size: random(3, 8),
                life: random(20, 40),
                alpha: 1,
                color: color
            });
        }
        
        function createLevelUpEffect() {
            for (let i = 0; i < 20; i++) {
                createParticle(width/2, height/2, color(255, 215, 0));
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('timeLeft').textContent = gameState.timeLeft;
            document.getElementById('combo').textContent = gameState.combo + 'x';
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('successfulJumps').textContent = gameState.successfulJumps;
            
            updateLivesDisplay();
        }
        
        function updateLivesDisplay() {
            const livesContainer = document.getElementById('lives');
            livesContainer.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const life = document.createElement('div');
                life.className = `life ${i >= gameState.lives ? 'lost' : ''}`;
                life.textContent = i >= gameState.lives ? 'üíî' : '‚ù§Ô∏è';
                livesContainer.appendChild(life);
            }
        }
        
        function checkCollisions() {
            let collision = false;
            
            obstacles.forEach(obstacle => {
                if (bike.x < obstacle.x + obstacle.width &&
                    bike.x + bike.width > obstacle.x &&
                    bike.y < obstacle.y + obstacle.height &&
                    bike.y + bike.height > obstacle.y) {
                    
                    collision = true;
                    
                    for (let i = 0; i < 15; i++) {
                        createParticle(bike.x + bike.width/2, bike.y + bike.height/2, color(255, 0, 0));
                    }
                    
                    gameState.lives--;
                    gameState.combo = 0;
                    
                    obstacles = obstacles.filter(o => o.id !== obstacle.id);
                    
                    if (gameState.lives <= 0) {
                        endGame(true);
                        return;
                    }
                }
            });
            
            if (!collision && !bike.isJumping && obstacles.length > 0) {
                obstacles.forEach(obstacle => {
                    if (bike.x + bike.width > obstacle.x + obstacle.width && 
                        !obstacle.passed) {
                        obstacle.passed = true;
                        gameState.successfulJumps++;
                        gameState.combo++;
                        gameState.maxCombo = max(gameState.maxCombo, gameState.combo);
                        
                        gameState.score += 10;
                        
                        for (let i = 0; i < 8; i++) {
                            createParticle(bike.x + bike.width/2, bike.y, color(0, 255, 0));
                        }
                    }
                });
            }
        }
        
        function spawnObstacle() {
            if (!gameState.isPlaying || gameState.gameOver) return;
            
            const types = ['projector', 'touchpanel', 'computer', 'speaker', 'camera'];
            const type = types[floor(random(types.length))];
            
            let obstacleWidth, obstacleHeight;
            switch(type) {
                case 'projector':
                    obstacleWidth = 45;
                    obstacleHeight = 35;
                    break;
                case 'touchpanel':
                    obstacleWidth = 40;
                    obstacleHeight = 50;
                    break;
                case 'computer':
                    obstacleWidth = 50;
                    obstacleHeight = 40;
                    break;
                case 'speaker':
                    obstacleWidth = 35;
                    obstacleHeight = 45;
                    break;
                case 'camera':
                    obstacleWidth = 30;
                    obstacleHeight = 30;
                    break;
                default:
                    obstacleWidth = 40;
                    obstacleHeight = 40;
            }
            
            obstacles.push({
                id: obstacleId++,
                x: width,
                y: 350 - obstacleHeight,
                width: obstacleWidth,
                height: obstacleHeight,
                type: type,
                passed: false
            });
            
            gameState.totalObstacles++;
            
            obstacleTimer = setTimeout(spawnObstacle, 2000 / gameState.gameSpeed);
        }
        
        function startGame() {
            if (gameState.isPlaying) return;
            
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.gameOver = false;
            gameState.score = 0;
            gameState.timeLeft = 30;
            gameState.level = 1;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.gameSpeed = 1;
            gameState.successfulJumps = 0;
            gameState.totalObstacles = 0;
            gameState.lives = 3;
            
            bike.y = bike.baseY;
            bike.isJumping = false;
            bike.x = 100;
            obstacles = [];
            particles = [];
            obstacleId = 0;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('gameOverModal').style.display = 'none';
            
            gameTimer = setInterval(() => {
                gameState.timeLeft--;
                if (gameState.timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);
            
            obstacleTimer = setTimeout(spawnObstacle, 1000);
            
            console.log('–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
        }
        
        function pauseGame() {
            if (!gameState.isPlaying) return;
            
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                clearInterval(gameTimer);
                clearTimeout(obstacleTimer);
            } else {
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                gameTimer = setInterval(() => {
                    gameState.timeLeft--;
                    if (gameState.timeLeft <= 0) {
                        endGame(false);
                    }
                }, 1000);
                obstacleTimer = setTimeout(spawnObstacle, 1000);
            }
        }
        
        function endGame(isFailure = false) {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            gameState.gameOver = true;
            
            clearInterval(gameTimer);
            clearTimeout(obstacleTimer);
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
            
            const modal = document.getElementById('gameOverModal');
            const title = document.getElementById('gameOverTitle');
            
            if (isFailure) {
                title.textContent = 'üí• –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –Ω–µ—É–¥–∞—á–µ–π!';
                title.style.color = '#e74c3c';
                modal.classList.add('failure');
            } else {
                title.textContent = 'üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!';
                title.style.color = '#4CAF50';
                modal.classList.remove('failure');
            }
            
            document.getElementById('finalScore').innerHTML = `
                <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <strong>${gameState.score}</strong></p>
                <p>–£—Å–ø–µ—à–Ω—ã–µ –ø—Ä—ã–∂–∫–∏: <strong>${gameState.successfulJumps}/${gameState.totalObstacles}</strong></p>
                <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–º–±–æ: <strong>${gameState.maxCombo}x</strong></p>
                <p>–£—Ä–æ–≤–µ–Ω—å: <strong>${gameState.level}</strong></p>
                <p>–¢–æ—á–Ω–æ—Å—Ç—å: <strong>${gameState.totalObstacles > 0 ? Math.round((gameState.successfulJumps / gameState.totalObstacles) * 100) : 0}%</strong></p>
                <p>–û—Å—Ç–∞–≤—à–∏–µ—Å—è –∂–∏–∑–Ω–∏: <strong>${gameState.lives}</strong></p>
            `;
            
            const discountCode = generateDiscountCode(gameState.score, gameState.maxCombo);
            if (discountCode) {
                document.getElementById('discountCode').textContent = discountCode;
                document.getElementById('discountCode').style.display = 'block';
            }
            
            modal.style.display = 'block';
        }
        
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            startGame();
        }
        
        function generateDiscountCode(score, maxCombo) {
            let discount = 0;
            if (score >= 1000) discount = 25;
            else if (score >= 500) discount = 15;
            else if (score >= 200) discount = 10;
            else if (score >= 100) discount = 5;
            
            if (maxCombo >= 50) discount += 5;
            if (maxCombo >= 100) discount += 10;
            
            return discount > 0 ? `WESHOW${discount}OFF` : null;
        }
        
        function mousePressed() {
            if (gameState.isPlaying && !gameState.isPaused && !gameState.gameOver) {
                jump();
            }
        }
        
        function keyPressed() {
            if (key === ' ' && gameState.isPlaying && !gameState.isPaused && !gameState.gameOver) {
                jump();
                return false;
            }
        }
        
        function jump() {
            if (bike.isJumping) return;
            
            bike.isJumping = true;
            bike.jumpStart = millis();
            
            for (let i = 0; i < 5; i++) {
                createParticle(bike.x + bike.width/2, bike.y + bike.height, color(100, 100, 255));
            }
        }
        
        function map(value, start1, stop1, start2, stop2) {
            return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
        }
        
        function min(a, b) {
            return a < b ? a : b;
        }
        
        function max(a, b) {
            return a > b ? a : b;
        }
        
        function floor(value) {
            return Math.floor(value);
        }
        
        function random(max) {
            return Math.random() * max;
        }
        
        function sin(angle) {
            return Math.sin(angle);
        }
        
        function PI() {
            return Math.PI;
        }
        
        function cos(angle) {
            return Math.cos(angle);
        }
        
        window.onload = function() {
            console.log('–§–∏–Ω–∞–ª—å–Ω–∞—è —É–ª—É—á—à–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ "–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –≥–æ–Ω–∫–∏" –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
        };
    </script>
</body>
</html>
