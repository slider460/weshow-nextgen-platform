# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø—Ä–æ–±–ª–µ–º –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å" –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–í—Ö–æ–¥...", –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≤–∏—Å–∞–µ—Ç.

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ AuthContext
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π `onAuthStateChange` –Ω–∞—Ö–æ–¥–∏–ª—Å—è –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `return` –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –∫–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ–¥ `return` –≤ useEffect.

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∏–ø—ã –≤ `auth.ts` —É–∫–∞–∑—ã–≤–∞–ª–∏, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Promise<void>`, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–∏–ø—ã –Ω–∞ `Promise<any>` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏.

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
- üîê –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Supabase
- üë§ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Ö–æ–¥–∞ –∏–ª–∏ ‚ùå –æ—à–∏–±–∫–∞

## –®–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞: http://localhost:8082/admin/login
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —Å –¥–∞–Ω–Ω—ã–º–∏:
   - **Email:** admin@weshow.ru
   - **–ü–∞—Ä–æ–ª—å:** password

4. –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:
   ```
   üöÄ Form submitted, attempting login...
   üîê Login attempt for: admin@weshow.ru
   ‚úÖ Login successful, data: {...}
   üë§ User profile: {...}
   ‚úÖ Login complete, redirecting...
   üìä Login result: true
   ‚úÖ Login successful, navigating to /admin/
   üèÅ Login process finished
   ```

### –®–∞–≥ 2: –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏

#### –û—à–∏–±–∫–∞: "Invalid login credentials"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```sql
-- –û—Ç–∫—Ä–æ–π—Ç–µ check_admin_login.sql –≤ Supabase SQL Editor
```

#### –û—à–∏–±–∫–∞: "‚ùå Profile not found for user"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ auth.users, –Ω–æ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –≤ user_profiles.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é:
```sql
INSERT INTO user_profiles (id, full_name, company_name, role)
SELECT 
  id,
  'Admin User',
  'WeShow',
  'admin'
FROM auth.users 
WHERE email = 'admin@weshow.ru'
ON CONFLICT (id) DO UPDATE SET role = 'admin';
```

#### –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ CORS
–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Supabase.

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Supabase URL –∏ –∫–ª—é—á –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –≤ `src/config/supabase.ts`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ Supabase Dashboard

### –®–∞–≥ 3: –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `test-admin-login.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

1. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ Supabase:
   - URL: `https://zbykhdjqrtqftfitbvbt.supabase.co`
   - Anon Key: (–∏–∑ `src/config/supabase.ts`)

2. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
   - Email: `admin@weshow.ru`
   - –ü–∞—Ä–æ–ª—å: `password`

3. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–¥"

4. –ï—Å–ª–∏ –≤—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω, –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT 
  au.id,
  au.email,
  au.email_confirmed_at,
  up.full_name,
  up.role
FROM auth.users au
LEFT JOIN user_profiles up ON au.id = up.id
WHERE au.email = 'admin@weshow.ru';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Email –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω (email_confirmed_at –Ω–µ NULL)
- –ü—Ä–æ—Ñ–∏–ª—å –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- –†–æ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 'admin' –∏–ª–∏ 'manager'

## –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —Å –Ω—É–ª—è

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:

```sql
-- 1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Supabase Dashboard:
-- Authentication -> Users -> Add user
-- Email: admin@weshow.ru
-- Password: password
-- Auto confirm: YES

-- 2. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å:
INSERT INTO user_profiles (id, full_name, company_name, role)
SELECT 
  id,
  '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
  'WeShow',
  'admin'
FROM auth.users 
WHERE email = 'admin@weshow.ru';
```

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+Shift+R –¥–ª—è hard reload)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
5. –ï—Å–ª–∏ –≤—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω, –≤–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ `/admin/`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `src/contexts/AuthContext.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `src/types/auth.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã
- ‚úÖ `src/pages/admin/AdminLogin.tsx` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
- üìÑ `check_admin_login.sql` - SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- üìÑ `test-admin-login.html` - —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- üìÑ `ADMIN_LOGIN_DEBUG_GUIDE.md` - —ç—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ

–ù–∞–ø–∏—à–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –≤–∏–¥–∏—Ç–µ. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É.

