# Исправление кнопки "Создать кейс"

## Проблема
Кнопка "Создать кейс" в админ панели не работала корректно.

## Найденные проблемы

### 1. Ошибка в функции `handleCreateCase`
- **Проблема**: `sort_order: cases.length + 1` - массив `cases` мог быть пустым или не загруженным
- **Исправление**: `sort_order: (cases?.length || 0) + 1`

### 2. Отсутствие переключения табов
- **Проблема**: После нажатия "Создать кейс" не переключалась на вкладку редактирования
- **Исправление**: Добавлено состояние `activeTab` и автоматическое переключение на вкладку "edit"

### 3. Отсутствие поля `video_url` в интерфейсе
- **Проблема**: В интерфейсе `CaseData` не было поля `video_url`, но оно использовалось в функции сохранения
- **Исправление**: Добавлено поле `video_url?: string` в интерфейс

### 4. Неправильное управление состоянием табов
- **Проблема**: Табы не управлялись через состояние React
- **Исправление**: Добавлено состояние `activeTab` и правильное управление переключением

## Внесенные изменения

### В файле `src/pages/admin/CaseManagement.tsx`:

1. **Добавлено состояние для управления табами:**
```typescript
const [activeTab, setActiveTab] = useState('list');
```

2. **Исправлена функция `handleCreateCase`:**
```typescript
const handleCreateCase = () => {
  const newCase: CaseData = {
    // ... остальные поля
    sort_order: (cases?.length || 0) + 1,
    video_url: '', // добавлено поле
  };
  setEditingCase(newCase);
  setIsCreating(true);
  setActiveTab('edit'); // переключение на вкладку редактирования
};
```

3. **Обновлена функция `handleEditCase`:**
```typescript
const handleEditCase = (caseItem: CaseData) => {
  setEditingCase({ ...caseItem });
  setIsCreating(false);
  setActiveTab('edit'); // переключение на вкладку редактирования
};
```

4. **Обновлена функция `handleSaveCase`:**
```typescript
// После успешного сохранения
setActiveTab('list'); // возврат к списку
```

5. **Обновлен компонент Tabs:**
```typescript
<Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
```

6. **Обновлена кнопка "Отмена":**
```typescript
onClick={() => {
  setEditingCase(null);
  setIsCreating(false);
  setActiveTab('list'); // возврат к списку
}}
```

7. **Добавлено поле `video_url` в интерфейс `CaseData`:**
```typescript
interface CaseData {
  // ... остальные поля
  video_url?: string;
  // ... остальные поля
}
```

## Результат
✅ Кнопка "Создать кейс" теперь работает корректно:
- Создает новый кейс с правильными значениями по умолчанию
- Автоматически переключает на вкладку редактирования
- Позволяет заполнить все поля кейса
- Сохраняет кейс в базу данных
- Возвращает к списку кейсов после сохранения

## Тестирование
- ✅ API для создания кейсов работает корректно
- ✅ Интерфейс обновлен и исправлен
- ✅ Управление состоянием работает правильно
- ✅ Переключение табов функционирует

## Файлы изменены
- `src/pages/admin/CaseManagement.tsx` - основные исправления
- `test_case_creation.js` - тестовый скрипт для проверки API


