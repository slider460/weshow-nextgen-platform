import { exec, spawn } from 'child_process';
import { promisify } from 'util';
import fs from 'fs/promises';
import path from 'path';

const execAsync = promisify(exec);

interface –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç {
  –Ω–∞–∑–≤–∞–Ω–∏–µ: string;
  –ø–æ—Ä—Ç?: number;
  –∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞: string;
  –∫–æ–º–∞–Ω–¥–∞–û—Å—Ç–∞–Ω–æ–≤–∫–∏?: string;
  –ø—É—Ç—å–ö–ü—Ä–æ—Ü–µ—Å—Å—É?: string;
  –ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è: () => Promise<boolean>;
  –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: number;
  –∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏: number; // –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}

interface –ò—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è {
  –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: string;
  timestamp: Date;
  –ø—Ä–∏—á–∏–Ω–∞: string;
  —Å–ø–æ—Å–æ–±–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: string;
  —É—Å–ø–µ—à–Ω–æ: boolean;
  –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: number;
}

interface –°—Ç–∞—Ç—É—Å–ó–¥–æ—Ä–æ–≤—å—è {
  –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: string;
  –∑–¥–æ—Ä–æ–≤: boolean;
  lastCheck: Date;
  –æ—à–∏–±–∫–∏: string[];
  –ø–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: number;
}

export class –°–∏—Å—Ç–µ–º–∞–°–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è {
  private –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç[] = [];
  private –∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: –ò—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è[] = [];
  private —Å—Ç–∞—Ç—É—Å—ã–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: Map<string, –°—Ç–∞—Ç—É—Å–ó–¥–æ—Ä–æ–≤—å—è> = new Map();
  private –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: Map<string, NodeJS.Timeout> = new Map();
  private –∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: Set<string> = new Set();
  private —Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞: boolean = false;

  constructor() {
    this.–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã();
  }

  private –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã(): void {
    this.–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã = [
      {
        –Ω–∞–∑–≤–∞–Ω–∏–µ: 'main-server',
        –ø–æ—Ä—Ç: 5173,
        –∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞: 'npm run dev',
        –∫–æ–º–∞–Ω–¥–∞–û—Å—Ç–∞–Ω–æ–≤–∫–∏: 'pkill -f "vite"',
        –ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è: () => this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—åHTTP–°–µ—Ä–≤–∏—Å('http://localhost:5173'),
        –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 3,
        –∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏: 10000 // 10 —Å–µ–∫—É–Ω–¥
      },
      {
        –Ω–∞–∑–≤–∞–Ω–∏–µ: 'debug-server',
        –ø–æ—Ä—Ç: 3001,
        –∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞: 'npm run debug:server',
        –∫–æ–º–∞–Ω–¥–∞–û—Å—Ç–∞–Ω–æ–≤–∫–∏: 'pkill -f "debug-server"',
        –ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è: () => this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—åHTTP–°–µ—Ä–≤–∏—Å('http://localhost:3001'),
        –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 3,
        –∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏: 15000 // 15 —Å–µ–∫—É–Ω–¥
      },
      {
        –Ω–∞–∑–≤–∞–Ω–∏–µ: 'node-process',
        –∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞: 'node --version',
        –ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è: () => this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ü—Ä–æ—Ü–µ—Å—ÅNode(),
        –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 2,
        –∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏: 30000 // 30 —Å–µ–∫—É–Ω–¥
      },
      {
        –Ω–∞–∑–≤–∞–Ω–∏–µ: 'file-system',
        –∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞: '',
        –ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è: () => this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å–§–∞–π–ª–æ–≤—É—é–°–∏—Å—Ç–µ–º—É(),
        –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 1,
        –∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏: 60000 // 1 –º–∏–Ω—É—Ç–∞
      }
    ];

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å—ã
    this.–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.forEach(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç => {
      this.—Å—Ç–∞—Ç—É—Å—ã–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.set(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ, {
        –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ,
        –∑–¥–æ—Ä–æ–≤: false,
        lastCheck: new Date(),
        –æ—à–∏–±–∫–∏: [],
        –ø–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 0
      });
    });

    console.log(`üè• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è –¥–ª—è ${this.–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.length} –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`);
  }

  public async –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å–ó–¥–æ—Ä–æ–≤—å–µ(): Promise<void> {
    if (this.—Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞) {
      console.log('‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞');
      return;
    }

    this.—Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞ = true;
    console.log('üè• –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —Å–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è...');

    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    for (const –∫–æ–º–ø–æ–Ω–µ–Ω—Ç of this.–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã) {
      await this.–∑–∞–ø—É—Å—Ç–∏—Ç—å–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—â–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
    this.–∑–∞–ø—É—Å—Ç–∏—Ç—å–û–±—â–∏–π–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥();

    console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–∞');
  }

  private async –∑–∞–ø—É—Å—Ç–∏—Ç—å–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    const –∏–Ω—Ç–µ—Ä–≤–∞–ª = setInterval(async () => {
      if (!this.—Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞) {
        clearInterval(–∏–Ω—Ç–µ—Ä–≤–∞–ª);
        return;
      }

      try {
        const –∑–¥–æ—Ä–æ–≤ = await this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ó–¥–æ—Ä–æ–≤—å–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
        const —Å—Ç–∞—Ç—É—Å = this.—Å—Ç–∞—Ç—É—Å—ã–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.get(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ)!;
        
        —Å—Ç–∞—Ç—É—Å.–∑–¥–æ—Ä–æ–≤ = –∑–¥–æ—Ä–æ–≤;
        —Å—Ç–∞—Ç—É—Å.lastCheck = new Date();

        if (!–∑–¥–æ—Ä–æ–≤ && !this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.has(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ)) {
          console.log(`üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}. –ó–∞–ø—É—Å–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...`);
          await this.–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
        }

      } catch (error) {
        console.error(`–û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}:`, error);
      }
    }, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∏–Ω—Ç–µ—Ä–≤–∞–ª–ü—Ä–æ–≤–µ—Ä–∫–∏);

    this.–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.set(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ, –∏–Ω—Ç–µ—Ä–≤–∞–ª);
    console.log(`üîç –ó–∞–ø—É—â–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
  }

  private –∑–∞–ø—É—Å—Ç–∏—Ç—å–û–±—â–∏–π–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥(): void {
    // –û–±—â–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    const –æ–±—â–∏–π–ò–Ω—Ç–µ—Ä–≤–∞–ª = setInterval(async () => {
      if (!this.—Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞) {
        clearInterval(–æ–±—â–∏–π–ò–Ω—Ç–µ—Ä–≤–∞–ª);
        return;
      }

      await this.–ø—Ä–æ–≤–µ—Å—Ç–∏–û–±—â—É—é–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É();
      await this.–æ—á–∏—Å—Ç–∏—Ç—å–°—Ç–∞—Ä—ã–µ–ó–∞–ø–∏—Å–∏();
      
    }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç

    this.–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.set('system-monitor', –æ–±—â–∏–π–ò–Ω—Ç–µ—Ä–≤–∞–ª);
  }

  public async –ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ó–¥–æ—Ä–æ–≤—å–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<boolean> {
    try {
      return await –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–ø—Ä–æ–≤–µ—Ä–∫–∞–ó–¥–æ—Ä–æ–≤—å—è();
    } catch (error) {
      console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}:`, error);
      return false;
    }
  }

  public async –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<boolean> {
    if (this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.has(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ)) {
      console.log(`‚è≥ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ} —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è`);
      return false;
    }

    const —Å—Ç–∞—Ç—É—Å = this.—Å—Ç–∞—Ç—É—Å—ã–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.get(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ)!;
    
    if (—Å—Ç–∞—Ç—É—Å.–ø–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è >= –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ–ü–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è) {
      console.error(`‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
      await this.—É–≤–µ–¥–æ–º–∏—Ç—å–û–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π–ü—Ä–æ–±–ª–µ–º–µ(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
      return false;
    }

    this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.add(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ);
    const startTime = Date.now();

    try {
      console.log(`üîß –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
      
      const —Å–ø–æ—Å–æ–±—ã–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è = [
        () => this.–º—è–≥–∫–∞—è–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç),
        () => this.–ø–æ–ª–Ω–∞—è–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç),
        () => this.–∑–∞–ø—É—Å–∫–ó–∞–ø–∞—Å–Ω–æ–≥–æ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç),
        () => this.–æ—Ç–∫–∞—Ç–ù–∞–ü—Ä–µ–¥—ã–¥—É—â—É—é–í–µ—Ä—Å–∏—é(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
      ];

      for (const [–∏–Ω–¥–µ–∫—Å, —Å–ø–æ—Å–æ–±] of —Å–ø–æ—Å–æ–±—ã–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.entries()) {
        try {
          console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è ${–∏–Ω–¥–µ–∫—Å + 1}/${—Å–ø–æ—Å–æ–±—ã–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.length} –¥–ª—è ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
          
          await —Å–ø–æ—Å–æ–±();
          
          // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          await this.–æ–∂–∏–¥–∞—Ç—å(5000);
          const –∑–¥–æ—Ä–æ–≤ = await this.–ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ó–¥–æ—Ä–æ–≤—å–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
          
          if (–∑–¥–æ—Ä–æ–≤) {
            const duration = Date.now() - startTime;
            console.log(`‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ} —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∑–∞ ${duration}ms`);
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
            this.–∑–∞–ø–∏—Å–∞—Ç—å–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ, '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', 
              `–°–ø–æ—Å–æ–± ${–∏–Ω–¥–µ–∫—Å + 1}`, true, duration);
            
            —Å—Ç–∞—Ç—É—Å.–ø–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
            —Å—Ç–∞—Ç—É—Å.–æ—à–∏–±–∫–∏ = [];
            
            return true;
          }
          
        } catch (error) {
          console.warn(`‚ö†Ô∏è –°–ø–æ—Å–æ–± –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è ${–∏–Ω–¥–µ–∫—Å + 1} –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}:`, error);
          —Å—Ç–∞—Ç—É—Å.–æ—à–∏–±–∫–∏.push(error.message);
        }
      }

      // –ï—Å–ª–∏ –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
      const duration = Date.now() - startTime;
      console.error(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
      
      this.–∑–∞–ø–∏—Å–∞—Ç—å–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ, '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞', 
        '–í—Å–µ —Å–ø–æ—Å–æ–±—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å', false, duration);
      
      —Å—Ç–∞—Ç—É—Å.–ø–æ–ø—ã—Ç–∫–∏–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è++;
      
      // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º–µ
      await this.—É–≤–µ–¥–æ–º–∏—Ç—å–û–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π–ü—Ä–æ–±–ª–µ–º–µ(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç);
      
      return false;

    } finally {
      this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.delete(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ);
    }
  }

  private async –º—è–≥–∫–∞—è–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    console.log(`üîÑ –ú—è–≥–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
    
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–ø–æ—Ä—Ç) {
      // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç
      await execAsync(`lsof -ti:${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–ø–æ—Ä—Ç} | xargs kill -9 || true`);
      await this.–æ–∂–∏–¥–∞—Ç—å(2000);
    }
    
    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞) {
      const –ø—Ä–æ—Ü–µ—Å—Å = spawn('sh', ['-c', –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞], {
        detached: true,
        stdio: 'ignore'
      });
      –ø—Ä–æ—Ü–µ—Å—Å.unref();
    }
  }

  private async –ø–æ–ª–Ω–∞—è–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    console.log(`üîÑ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–û—Å—Ç–∞–Ω–æ–≤–∫–∏) {
      await execAsync(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–û—Å—Ç–∞–Ω–æ–≤–∫–∏);
    }
    
    await this.–æ–∂–∏–¥–∞—Ç—å(3000);
    
    // –û—á–∏—â–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ –ø–æ—Ä—Ç—É
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–ø–æ—Ä—Ç) {
      await execAsync(`lsof -ti:${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–ø–æ—Ä—Ç} | xargs kill -9 || true`);
    }
    
    await this.–æ–∂–∏–¥–∞—Ç—å(2000);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞) {
      const –ø—Ä–æ—Ü–µ—Å—Å = spawn('sh', ['-c', –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞], {
        detached: true,
        stdio: 'ignore'
      });
      –ø—Ä–æ—Ü–µ—Å—Å.unref();
    }
  }

  private async –∑–∞–ø—É—Å–∫–ó–∞–ø–∞—Å–Ω–æ–≥–æ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    console.log(`üîÑ –ó–∞–ø—É—Å–∫ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
    
    // –õ–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫ backup-—Å–µ—Ä–≤–∏—Å–∞
    
    if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ === 'main-server') {
      // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–º –ø–æ—Ä—Ç—É
      const –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è–ö–æ–º–∞–Ω–¥–∞ = –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞.replace('5173', '5174');
      const –ø—Ä–æ—Ü–µ—Å—Å = spawn('sh', ['-c', –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è–ö–æ–º–∞–Ω–¥–∞], {
        detached: true,
        stdio: 'ignore'
      });
      –ø—Ä–æ—Ü–µ—Å—Å.unref();
    }
  }

  private async –æ—Ç–∫–∞—Ç–ù–∞–ü—Ä–µ–¥—ã–¥—É—â—É—é–í–µ—Ä—Å–∏—é(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    console.log(`üîÑ –û—Ç–∫–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é: ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
    
    try {
      // –û—Ç–∫–∞—Ç git –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
      await execAsync('git stash');
      await execAsync('git reset --hard HEAD~1');
      
      // –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      await execAsync('npm install');
      
      // –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
      await execAsync('npm run build:dev');
      
      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
      if (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞) {
        const –ø—Ä–æ—Ü–µ—Å—Å = spawn('sh', ['-c', –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–∫–æ–º–∞–Ω–¥–∞–ó–∞–ø—É—Å–∫–∞], {
          detached: true,
          stdio: 'ignore'
        });
        –ø—Ä–æ—Ü–µ—Å—Å.unref();
      }
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–∞—Ç–∞ –≤–µ—Ä—Å–∏–∏:', error);
      throw error;
    }
  }

  // –ú–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
  private async –ø—Ä–æ–≤–µ—Ä–∏—Ç—åHTTP–°–µ—Ä–≤–∏—Å(url: string): Promise<boolean> {
    try {
      const response = await fetch(url, { 
        method: 'HEAD',
        timeout: 5000 
      } as any);
      return response.ok;
    } catch (error) {
      return false;
    }
  }

  private async –ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ü—Ä–æ—Ü–µ—Å—ÅNode(): Promise<boolean> {
    try {
      const { stdout } = await execAsync('node --version');
      return stdout.includes('v');
    } catch (error) {
      return false;
    }
  }

  private async –ø—Ä–æ–≤–µ—Ä–∏—Ç—å–§–∞–π–ª–æ–≤—É—é–°–∏—Å—Ç–µ–º—É(): Promise<boolean> {
    try {
      const –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ü—É—Ç–∏ = [
        './package.json',
        './src/main.tsx',
        './debug-server'
      ];
      
      for (const –ø—É—Ç—å of –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ–ü—É—Ç–∏) {
        await fs.access(–ø—É—Ç—å);
      }
      
      return true;
    } catch (error) {
      return false;
    }
  }

  private async —É–≤–µ–¥–æ–º–∏—Ç—å–û–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π–ü—Ä–æ–±–ª–µ–º–µ(–∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π–ö–æ–º–ø–æ–Ω–µ–Ω—Ç): Promise<void> {
    const —Å–æ–æ–±—â–µ–Ω–∏–µ = `üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ${–∫–æ–º–ø–æ–Ω–µ–Ω—Ç.–Ω–∞–∑–≤–∞–Ω–∏–µ} –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!`;
    
    console.error(—Å–æ–æ–±—â–µ–Ω–∏–µ);
    
    // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–¥–µ—Å—å –±—É–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
    // - Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
    // - Slack/Teams —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    // - SMS –∞–ª–µ—Ä—Ç—ã
    // - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
    
    // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥ —Ñ–∞–π–ª
    try {
      const –ª–æ–≥–°–æ–æ–±—â–µ–Ω–∏–µ = `${new Date().toISOString()} - ${—Å–æ–æ–±—â–µ–Ω–∏–µ}\n`;
      await fs.appendFile('./critical-issues.log', –ª–æ–≥–°–æ–æ–±—â–µ–Ω–∏–µ);
    } catch (error) {
      console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã:', error);
    }
  }

  private –∑–∞–ø–∏—Å–∞—Ç—å–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ(
    –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: string, 
    –ø—Ä–∏—á–∏–Ω–∞: string, 
    —Å–ø–æ—Å–æ–±: string, 
    —É—Å–ø–µ—à–Ω–æ: boolean, 
    –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: number
  ): void {
    const –∑–∞–ø–∏—Å—å: –ò—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è = {
      –∫–æ–º–ø–æ–Ω–µ–Ω—Ç,
      timestamp: new Date(),
      –ø—Ä–∏—á–∏–Ω–∞,
      —Å–ø–æ—Å–æ–±–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: —Å–ø–æ—Å–æ–±,
      —É—Å–ø–µ—à–Ω–æ,
      –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    };
    
    this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.push(–∑–∞–ø–∏—Å—å);
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
    if (this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.length > 1000) {
      this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è = this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.slice(-1000);
    }
  }

  private async –ø—Ä–æ–≤–µ—Å—Ç–∏–û–±—â—É—é–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É(): Promise<void> {
    console.log('üîç –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±—â–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã...');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
    const memoryUsage = process.memoryUsage();
    const cpuUsage = process.cpuUsage();
    
    if (memoryUsage.heapUsed > 1024 * 1024 * 1024) { // 1GB
      console.warn(`‚ö†Ô∏è –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏: ${Math.round(memoryUsage.heapUsed / 1024 / 1024)}MB`);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    try {
      const { stdout } = await execAsync('df -h .');
      const —Å—Ç—Ä–æ–∫–∏ = stdout.split('\n');
      if (—Å—Ç—Ä–æ–∫–∏.length > 1) {
        const –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ = —Å—Ç—Ä–æ–∫–∏[1].split(/\s+/)[4];
        const –ø—Ä–æ—Ü–µ–Ω—Ç = parseInt(–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.replace('%', ''));
        
        if (–ø—Ä–æ—Ü–µ–Ω—Ç > 90) {
          console.warn(`‚ö†Ô∏è –ú–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ: ${–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ`);
        }
      }
    } catch (error) {
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ:', error);
    }
  }

  private async –æ—á–∏—Å—Ç–∏—Ç—å–°—Ç–∞—Ä—ã–µ–ó–∞–ø–∏—Å–∏(): Promise<void> {
    const –º–µ—Å—è—Ü–ù–∞–∑–∞–¥ = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
    
    const –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π–†–∞–∑–º–µ—Ä = this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.length;
    this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è = this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.filter(
      –∑–∞–ø–∏—Å—å => –∑–∞–ø–∏—Å—å.timestamp >= –º–µ—Å—è—Ü–ù–∞–∑–∞–¥
    );
    
    const —É–¥–∞–ª–µ–Ω–æ = –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π–†–∞–∑–º–µ—Ä - this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.length;
    if (—É–¥–∞–ª–µ–Ω–æ > 0) {
      console.log(`üßπ –û—á–∏—â–µ–Ω–æ ${—É–¥–∞–ª–µ–Ω–æ} —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è`);
    }
  }

  private –æ–∂–∏–¥–∞—Ç—å(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  public async –ø—Ä–æ–≤–µ—Ä–∏—Ç—å–ó–¥–æ—Ä–æ–≤—å–µ–°–∏—Å—Ç–µ–º—ã(): Promise<any> {
    const —Å—Ç–∞—Ç—É—Å—ã = Array.from(this.—Å—Ç–∞—Ç—É—Å—ã–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.values());
    
    return {
      –æ–±—â–µ–µ–ó–¥–æ—Ä–æ–≤—å–µ: —Å—Ç–∞—Ç—É—Å—ã.every(s => s.–∑–¥–æ—Ä–æ–≤),
      –∑–¥–æ—Ä–æ–≤—ã–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: —Å—Ç–∞—Ç—É—Å—ã.filter(s => s.–∑–¥–æ—Ä–æ–≤).length,
      –æ–±—â–µ–µ–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: —Å—Ç–∞—Ç—É—Å—ã.length,
      –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: —Å—Ç–∞—Ç—É—Å—ã.filter(s => !s.–∑–¥–æ—Ä–æ–≤).map(s => s.–∫–æ–º–ø–æ–Ω–µ–Ω—Ç),
      –∞–∫—Ç–∏–≤–Ω—ã–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: Array.from(this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ),
      –ø–æ—Å–ª–µ–¥–Ω—è—è–ü—Ä–æ–≤–µ—Ä–∫–∞: new Date()
    };
  }

  public –ø–æ–ª—É—á–∏—Ç—å–ò—Å—Ç–æ—Ä–∏—é–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è(–ª–∏–º–∏—Ç: number = 50): –ò—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è[] {
    return this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
      .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())
      .slice(0, –ª–∏–º–∏—Ç);
  }

  public –ø–æ–ª—É—á–∏—Ç—å–°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è(): any {
    const –∏—Å—Ç–æ—Ä–∏—è = this.–∏—Å—Ç–æ—Ä–∏—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è;
    const –ø–æ—Å–ª–µ–¥–Ω–∏–π24—á = –∏—Å—Ç–æ—Ä–∏—è.filter(h => 
      (Date.now() - h.timestamp.getTime()) < 24 * 60 * 60 * 1000
    );
    
    return {
      –≤—Å–µ–≥–æ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π: –∏—Å—Ç–æ—Ä–∏—è.length,
      —É—Å–ø–µ—à–Ω—ã—Ö–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π: –∏—Å—Ç–æ—Ä–∏—è.filter(h => h.—É—Å–ø–µ—à–Ω–æ).length,
      –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π–ó–∞24—á: –ø–æ—Å–ª–µ–¥–Ω–∏–π24—á.length,
      —Å—Ä–µ–¥–Ω–µ–µ–í—Ä–µ–º—è–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: –∏—Å—Ç–æ—Ä–∏—è.length > 0 ? 
        Math.round(–∏—Å—Ç–æ—Ä–∏—è.reduce((sum, h) => sum + h.–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, 0) / –∏—Å—Ç–æ—Ä–∏—è.length) : 0
    };
  }

  public async –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å–°–∏—Å—Ç–µ–º—É(): Promise<void> {
    this.—Å–∏—Å—Ç–µ–º–∞–ê–∫—Ç–∏–≤–Ω–∞ = false;
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    for (const [–Ω–∞–∑–≤–∞–Ω–∏–µ, –∏–Ω—Ç–µ—Ä–≤–∞–ª] of this.–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞) {
      clearInterval(–∏–Ω—Ç–µ—Ä–≤–∞–ª);
      console.log(`‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: ${–Ω–∞–∑–≤–∞–Ω–∏–µ}`);
    }
    
    this.–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.clear();
    this.–∞–∫—Ç–∏–≤–Ω–æ–µ–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.clear();
    
    console.log('üè• –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–∏—Å—Ü–µ–ª–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
  }
}